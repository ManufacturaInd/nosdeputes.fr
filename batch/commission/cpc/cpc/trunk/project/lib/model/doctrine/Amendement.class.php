<?php

/**
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class Amendement extends BaseAmendement {
    public function setAuteurs($auteurs) {
    //        parse string -> noms_famille + sexe, des fois nom complet?
    //        foreach ($array as $name, $sexe)
    //          addParlementaireByNom($nom, $sexe)
    }

    public function addParlementaireByNom($nom, $sexe) {
        $memeNom = Doctrine::getTable('Parlementaire')->findAllByNomFamille($nom);
        if (!$memeNom)
            $depute = Doctrine::getTable('Parlementaire')->similarTo($nom);
        elseif (count($memeNom) == 1)
            $depute = $memeNom[0];
        else {
            $count == 0;
            foreach ($memeNom as $de)
                if ($de->sexe == $sexe) {
                    if ($count == 0) {
                        $count ++;
                        $depute = $de;
                    } else $depute = NULL;
                }
        }
        if (!$depute) {
            $depute = new Parlementaire();
            $depute->setNom($nom);
            $depute->setType('depute');
            $depute->save();
        }
        foreach($this->getParlementaires() as $par) {
            if ($par == $depute)
                return false;
        }
        $pa = new ParlementaireAmendement();
        $pa->amendement = $this;
        $pa->parlementaire = $depute;
        return $pa->save();
    }

    public function setSort($sort) {
// parse sort to fit enum
    }

    public function getLink() {
        return "http://www.assembleenationale.fr/".$this->id.".asp";
    }
}