#!/bin/bash


# Mis là temporairement pour rappel: à runner une fois pour toutes pour éviter de retélécharger inutilement 2000 amendements à chaque fois (OGM et HADOPI)
# php symfony set:AmdmtsTombes 819 
# php symfony set:AmdmtsTombes 1296


# Mise à jur de la liste des députés
echo MaJ Deputes
echo =======================
bash bin/load_deputes


# Récupération et création des JSON
echo JO
echo =======================
cd batch/jo ; perl compute_latest.pl ; cd -
echo Hemicycle
echo =======================
cd batch/hemicycle ; bash compute_latest.sh ; cd -
echo Commission
echo =======================
cd batch/commission ; bash compute_latest.sh ; cd -
echo Amendements
echo =======================
cd batch/amendements ; bash compute_latest.sh ; cd -
echo Questions
echo =======================
cd batch/questions ; bash compute_latest.sh ; cd -


# Vérification des JSON



# Chargement via tasks
echo load JO
echo =======================
while ! php symfony load:JO ; do
        php symfony cc > /dev/null
done;

echo Load Hemicycle
echo =======================
while ls batch/hemicycle/out | grep [a-z] > /dev/null ; do 
	php symfony cc > /dev/null
	php symfony load:Hemicycle 
done;
echo Load commission
echo =======================
while ls batch/commission/out | grep [a-z] > /dev/null ; do
	php symfony cc > /dev/null
	php symfony load:Commission 
done;
echo Load Amendements
echo =======================
while ls batch/amendements/json | grep [a-z] > /dev/null ; do
	php symfony cc > /dev/null
	php symfony load:Amdmts 
done;
echo Load Question
echo =======================
while ls batch/questions/json | grep [a-z] > /dev/null ; do
	php symfony cc > /dev/null
	php symfony load:Questions 
done;

echo Post
echo =======================
# Postprocessings
echo Tags
echo =======================
bash bin/tag_seance
echo Session
echo =======================
php symfony set:Session 
echo Vacances
echo =======================
php symfony set:Vacances 
echo Top
echo =======================
php symfony top:Deputes 


