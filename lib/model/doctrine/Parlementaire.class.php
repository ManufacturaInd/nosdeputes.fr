<?php

require_once "myTools.class.php";

/**
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class Parlementaire extends BaseParlementaire
{

  public function setNom($str) {
    if (preg_match('/^\S+ [a-z\s\']*([A-Z].+)/', $str, $match)) {
      $this->_set('nom_de_famille', $match[1]);
    }
    return $this->_set('nom', $str);
  }

  public function getCirconscription() {
    return $this->nom_circo."(".$this->num_circo.")";
  }

  public function setCirconscription($str) {
    if (preg_match('/(.*)\((\d+)/', $str, $match)) {
      $this->nom_circo = $match[1];
      $this->num_circo = $match[2];
    }
  }

  public function setDebutMandat($str) {
    if (preg_match('/(\d{2})\/(\d{2})\/(\d{4})/', $str, $m)) {
      $this->_set('debut_mandat', $m[3].'-'.$m[2].'-'.$m[1]);
    }
  }
  public function setFonctions($array) {
    return $this->setParlementaireOrganisme('parlementaire', $array);
  }
  public function setExtras($array) {
    return $this->setParlementaireOrganisme('extra', $array);
  }
  public function setGroupe($array) {
    return $this->setParlementaireOrganisme('groupe', $array);
  }
  public function setParlementaireOrganisme($type, $array) {
    $orgas = $this->getOrganismes();
    foreach ($array as $item) {
      $args = preg_split('/\s+\/\s*/', $item);
      $orga = Doctrine::getTable('Organisme')->findOneByNom($args[0]);
      if (!$orga) {
	$orga = new Organisme();
	$orga->nom = $args[0];
	$orga->type = $type;
	$orga->save();
      }
      $orgas->add($orga);
    }
    $this->_set('Organismes', $orgas);
  }
  public function setAutresmandats($array) {

  }
  public function setMails($array) {
  }
  public function setAdresses($array) {
  }
}